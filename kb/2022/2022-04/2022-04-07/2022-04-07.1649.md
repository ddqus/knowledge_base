# Separation of Concerns in ORM

```
#ddd #orm #srp
```

* ORM 의 역할
    * 도메인 엔티티는 영속화에 대해 몰라야 한다.
    * 데이터베이스는 도메인(비즈니스) 로직에 대해 몰라야 한다.
    * 그렇다면 이 둘을 연결해주는 역할이 필요하다. 그것이 ORM의 역할이다.


* 영속화 로직이 도메인으로 유출되는 경우 (도메인 영역의 문제)
    * 도메인 로직에서 영속화 상태를 기반(근거)으로 하는 로직을 작성하는 경우.
        * 도메인은 영속화 상태에 기반한 판단을 하면 안된다.
    * 영속화 id 를 이용한 로직을 작성하는 경우
        * 영속화 id는 영속화 도구이지 도메인 로직의 영역이 아니다.
        * 객체를 비교해야 할 경우 id 비교가 아닌 동등성 비교를 해야한다.

* 도메인 로직이 영속화 로직으로 유출되는 경우 (영속화 영역의 문제)
    * 삭제 cascade 를 사용하는 것
        * 삭제 cascade 는 도메인 로직이어야 한다.
    * 스토어드 프로시저
        * 스토어드 프로시저는 로직이 담겨있으니 도메인 로직이 유출될 수 있다.
        * 예외1) 조회 전용 스토어드 프로시저, 부작용이 없으니 사용해도 된다.
        * 예외2) 필수적인 경우, e.g. delete 배치 작업
    * 테이블 컬럼의 기본값 설정
        * 컬럼의 기본값은 도메인 로직에 해당한다.
        * 기본값은 도메인 엔티티에서 정의되어야 한다.

* database 를 통합 지점으로 접근하는 방식은 좋지 않다.

> https://enterprisecraftsmanship.com/posts/separation-of-concerns-in-orm/
